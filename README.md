# Моделирование сети кинотеатров по стране на Linux в Docker
для души и зачета

## Как задается кинотеатр?
Любой кинотеатр задается файлом с расширением `.json` в папке cinemas. Внутри можно встретить говорящие поля `city`, `name`, `halls`, из которых собирается соответствующая структура в программе. 

## Что происходит вообще? 
Моделируется посещение кинотеатров людьми, которые побиты на три типа
* ребенок `Child`
* человек средних лет `Midd`
* пожилой человек `Senior`

Каждый тип людей генерирует свого рода "довольство" от посещения кинотеатра. Довольство - это случайная величина в пределах `[0; 1]`, которая зависит от того, насколько близко к центру человек смог занять место. Чем ближе, тем довольство выше. Приведем правила, по которым получается довольство:

| Тип           | Довольство                |
| ------------- |:-------------------------:|
| Child         | 1                         |
| Midd          | `[1 - q/10, 1]`           |
| Senior        | `[0, q]`                  |

где `q` - близость к центру (в центре 1, в краю 0). Важно, что довольство выбирается равномерно из отрезка (кроме ребенка). 

### философское отклонение про довольство людей

* Дети очень радуются кино (вроде как...), поэтому всегда `1`
* Взрослые любят критиковать, начинаются сомнения и т.д.. Однако, все еще испытывают удовольствие и продолжают смотреть кино, если им это интересно изначально
* Сторики ворчат... Но не всегда, поэтому даем им шанс выдать хорошую оценку

## Архитектура программы
Вся программа состоит из многих компонентов, из которых выделим 4 главных

* CLI (интерфейс командной строки)
* CinemaNetwork (сеть кинотеатров, кто бы мог подумать...)
* People 
* многопоточное моделирование

разберем каждый по очереди

### CLI
Здесь создан потокобезопасный класс работы с терминалом, в котором можно рисовать gauge/metrics и немного текста. Рисуются вот такие штуки 

┌──────────────────────name metric 44────────────────────┐
│████████████████████████████████████████████████████│
└────────────────────────────────────────────────────┘

полоска показывает состояние чего-то, а имя центрируется (на примере не очень по центру...), в нашем случае это рейтинг города из сети кинотеатров.

Есть обработка клавиш:
`q`, `w`, `s` - выход, переключить выделение на метрику выше, переключить выделение на метрику ниже. Поддерживается CAPS. 

Также выводится количество промоделированных дней и приятный бонус для ценителей, когда нажимается `q`. Так как CLI один, то логично было сделать его singleton, что и было сделано через статический указатель внутри класса, который конструируется в отдельной функции с использованием mutex (вдруг его будут пытаться создать несколько раз из разных потоков). 

### CinemaNetwork 
Класс сети кинотеатров, поддерживающий необходимый функционал для моделирования, так же сделан в singleton стиле, но конструируем мы его уже самостоятельно. 

### People
Есть люди, которые ходят в кино и дают разный рейтинг. Было использовано наследование от класса `Person`. В дальнейшем переопределяются методы довольства для соответствующего типа человека.

### mutlithreading-modeling
Здесь мы создаем людей и потоки, которые их обрабатывают. Механизм моделирования следующий:
1. Есть дни, в них каждый человек с какой-то вероятностью решает пойти в кино в своем городе
2. Предполагаем упрощенную модель, где один кинотеатр показывает одно кино в день
3. Итерируемся по дням, синхронизируя потоки через condition_variable
    * Главный main поток управляет днями и будит все потоки при новом дне
    * Каждый поток засыпает, пока не придет условие, что пора обрабатывать следующий день, или нажато `q` (последнее делаетс через atomic_bool переменную)

## Нюансы
1. Рисует графику круто (имхо), но из-за большого спроса на перерисовку требуется очень часто двигать курсор, что немного бросается в глаза
2. Все это упаковано в Docker, а также протестировано
3. Из посторонних библиотек используется только одна, которая облегчает работу с `json`
4. Для упрощения создания людей испульзуется template-программирование
5. Присутствует Covid ограничения на места в кино! Даже такую штуку учитываем...